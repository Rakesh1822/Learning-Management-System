package com.te.lms.service;

import static org.junit.jupiter.api.Assertions.assertEquals;
import static org.junit.jupiter.api.Assertions.assertFalse;
import static org.junit.jupiter.api.Assertions.assertTrue;

import java.time.LocalDate;
import java.util.List;
import java.util.Optional;

import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Disabled;
import org.junit.jupiter.api.Test;
import org.mockito.InjectMocks;
import org.mockito.Mock;
import org.mockito.Mockito;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.boot.test.mock.mockito.MockBean;

import com.google.common.collect.Lists;
import com.te.lms.dto.MentorDto;
import com.te.lms.dto.MessageDto;
import com.te.lms.dto.SkillsDto;
import com.te.lms.entity.Admin;
import com.te.lms.entity.AppUser;
import com.te.lms.entity.Batch;
import com.te.lms.entity.Mentor;
import com.te.lms.entity.Roles;
import com.te.lms.entity.Skills;
import com.te.lms.enums.BatchStatus;
import com.te.lms.enums.Status;
import com.te.lms.repository.AdminRepository;
import com.te.lms.repository.AppUserRepository;
import com.te.lms.repository.BatchRepository;
import com.te.lms.repository.MentorRepository;
import com.te.lms.repository.RolesRepository;
import com.te.lms.service.implementation.AdminServiceImpl;

@SpringBootTest
class TestAdminServiceImpl {

	@Mock
	private MentorRepository mentorRepository;

	@Mock
	private AppUserRepository appUserRepository;

	@Mock
	private AdminRepository adminRepository;

	@Mock
	private RolesRepository rolesRepository;

	@Mock
	private BatchRepository batchRepository;

	@InjectMocks
	private AdminServiceImpl adminService;

	@BeforeEach
	public void setUp() {
		Roles employee = Roles.builder().roleName("ROLE_EMPLOYEE").build();
		Roles mentor = Roles.builder().roleName("ROLE_MENTOR").build();
		Roles admin = Roles.builder().roleName("ROLE_ADMIN").appUser(Lists.newArrayList()).build();

		Admin admin01 = Admin.builder().adminId("TYC001").adminName("Rakesh Reddy").build();

		AppUser adminCredentials = AppUser.builder().username(admin01.getAdminId()).password("password")
				.roles(Lists.newArrayList()).build();

		admin.getAppUser().add(adminCredentials);
		adminCredentials.getRoles().add(admin);

		rolesRepository.save(employee);
		rolesRepository.save(mentor);
		rolesRepository.save(admin);
		adminRepository.save(admin01);

		appUserRepository.save(adminCredentials);
	}

	@Test
	public void testRegisterMentor() {

		MentorDto mentorDto = MentorDto.builder().employeeId("TY001").emailId("mentor@gmail.com")
				.skillsDto(List.of(SkillsDto.builder().skillName("java").build())).mentorName("Rakesh").build();
		Mentor mentor = Mentor.builder().employeeId("TY001").emailId("mentor@gmail.com")
				.skills(List.of(Skills.builder().skillName("java").build())).mentorName("Rakesh").build();
		AppUser appUser = AppUser.builder().username(mentorDto.getEmployeeId()).password("Welcome123")
				.roles(Lists.newArrayList()).build();
		Roles role = Roles.builder().roleName("ROLE_MENTOR").appUser(Lists.newArrayList()).build();
		appUser.getRoles().add(role);
		role.getAppUser().add(appUser);
		Mockito.when(rolesRepository.findByRoleName(Mockito.any())).thenReturn(Optional.ofNullable(role));
		Mockito.when(appUserRepository.save(Mockito.any())).thenReturn(appUser);
		Mockito.when(mentorRepository.save(Mockito.any())).thenReturn(mentor);
		String message = "Hello " + mentor.getMentorName() + " \n" + " welcome to the team of techno elevate"
				+ "username : " + appUser.getUsername() + "\n" + " password :" + appUser.getPassword();
		MessageDto messageDto = MessageDto.builder().message(message).emaild(mentor.getEmailId()).build();
		Optional<MessageDto> messageDto2 = adminService.registerMentor(mentorDto);
		assertEquals(messageDto2.get().getEmaild(), mentor.getEmailId());

	}

	@Test
	public void TestDeleteMentor_ReturnsTrue() {
		Mentor mentor = Mentor.builder().employeeId("TY001").emailId("mentor@gmail.com")
				.skills(List.of(Skills.builder().skillName("java").build())).mentorName("Rakesh").build();
		Mockito.when(mentorRepository.findById(Mockito.any())).thenReturn(Optional.ofNullable(mentor));
		Mockito.when(mentorRepository.save(Mockito.any())).thenReturn(mentor);
		Boolean isDeleted = adminService.deleteMentor(Mockito.any());
		assertTrue(isDeleted);

	}

	@Test
	public void TestDeleteMentor_ReturnsFalse() {
		Mentor mentor = Mentor.builder().employeeId("TY001").emailId("mentor@gmail.com")
				.skills(List.of(Skills.builder().skillName("java").build())).mentorName("Rakesh").build();
		Mockito.when(mentorRepository.findById(Mockito.any())).thenReturn(Optional.ofNullable(null));
		Mockito.when(mentorRepository.save(Mockito.any())).thenReturn(mentor);
		Boolean isDeleted = adminService.deleteMentor(Mockito.any());
		assertFalse(isDeleted);
	}

	@Test
	public void TestDeletebatch_ReturnsTrue() {
		Batch batch = Batch.builder().batchId("Batch-01").batchName("batch01").batchStatus(BatchStatus.TOBESTARTED)
				.startDate(LocalDate.of(2022, 02, 10)).endDate(LocalDate.of(2022, 04, 10))
				.employee(Lists.newArrayList()).build();
		Mockito.when(batchRepository.findById(Mockito.any())).thenReturn(Optional.ofNullable(batch));
		Boolean isDeleted = adminService.deleteBatch(Mockito.any());
		assertTrue(isDeleted);
	}

	@Test
	public void TestDeletebatch_ReturnsFalse() {
		Batch batch = Batch.builder().batchId("Batch-01").batchName("batch01").batchStatus(BatchStatus.TOBESTARTED)
				.startDate(LocalDate.of(2022, 02, 10)).endDate(LocalDate.of(2022, 04, 10))
				.employee(Lists.newArrayList()).build();
		Mockito.when(batchRepository.findById(Mockito.any())).thenReturn(Optional.ofNullable(null));
		Boolean isDeleted = adminService.deleteBatch(Mockito.any());
		assertFalse(isDeleted);
	}
	
	@Test
	public void TestCreateBatch() {
		Batch batch = Batch.builder().batchId("Batch-01").batchName("batch01").batchStatus(BatchStatus.TOBESTARTED)
				.startDate(LocalDate.of(2022, 02, 10)).endDate(LocalDate.of(2022, 04, 10))
				.employee(Lists.newArrayList()).build();
	}

}
